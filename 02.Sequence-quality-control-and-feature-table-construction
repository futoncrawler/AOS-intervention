QIIME 2 plugins are available for several quality control methods,  including DADA2, Deblur, and basic quality-score-based filtering. 
In DADA2, error sequences are changed to match the sequence from which they're inferred to have arisen.
In Deblur, those sequences are removed.
DADA2 is a pipeline for detecting and correcting (where possible) Illumina amplicon sequence data.
As implemented in the q2-dada2 plugin, this quality control process will additionally filter any
phiX reads (commonly present in marker gene Illumina sequence data) that are identified in the
sequencing data, and will filter chimeric sequences.

The dada2 denoise-single method requires two parameters that are used in quality filtering:
--p-trim-left m, which trims off the first m bases of each sequence, and --p-trunc-len n which truncates
each sequence at position n. This allows the user to remove low quality regions of the sequences.
To determine what values to pass for these two parameters, you should review 
the Interactive Quality Plot tab in the demux-paired-end.qzv file that was generated by qiime demux summarize above.

qiime dada2 denoise-paired \
  --i-demultiplexed-seqs demux-paired-end.qza \
  --p-trim-left-f 15 \
  --p-trim-left-r 15 \
  --p-trunc-len-f 240 \
  --p-trunc-len-r 240 \
  --o-table table.qza \
  --o-representative-sequences rep-seqs.qza \
  --o-denoising-stats denoising-stats.qza

Expected Output Artifacts:
1. FeatureTable[Frequency] table.qza
2. FeatureData[Sequence] rep-seqs.gza
3. SampleData[Dada2Stats] denoising-stats.qza

But this time we will first conduct subsample paired sequences. This plugin is optional, it functions to generate a random
subsample of paired-end sequences containing approximately the fraction of input sequences specified by the fraction parameter. The
number of output samples will always be equal to the number of input samples, even if some of those samples contain no sequences after
subsampling.

---------------------------------------------------------------------------------------------------------------------------
qiime demux subsample-paired \
--i-sequences demux-paired-end.qza \
--p-fraction 0.05 \
--o-subsampled-sequences demux-subsample.qza

qiime demux summarize \
--i-data demux-subsample.qza \
--o-visualization demux-subsample.qzv

#結果の確認
・トリミング長の設定　DADA2では20bp以上のオーバラップが必要

for i in {130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280}; do \
qiime dada2 denoise-paired \
--verbose \
--p-n-threads 0 \
--p-trim-left-f 15 \
--p-trim-left-r 15 \
--p-trunc-len-f $i \
--p-trunc-len-r $i \
--i-demultiplexed-seqs demux-subsample.qza \
--o-table table_trunclen-${i}.qza \
--o-representative-sequences rep-seqs_trunclen-${i}.qza \
--o-denoising-stats stats-dada2_trunclen-${i}.qza \
;done

for i in {130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280}; do \
qiime metadata tabulate \
--m-input-file stats-dada2_trunclen-${i}.qza \
--o-visualization stats-dada2_trunclen-${i}.qzv \
;done

#Each artifacts summaries generation
qiime feature-table summarize \
  --i-table table.qza \
  --o-visualization table.qzv \
  --m-sample-metadata-file metadata_16S_adult.txt

qiime feature-table tabulate-seqs \
  --i-data rep-seqs.qza \
  --o-visualization rep-seqs.qzv

qiime metadata tabulate \
  --m-input-file denoising-stats.qza \
  --o-visualization denoising-stats.qzv
